<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HeyHoLetsGo ‚Äì Productivity & Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #fdf6ec;
      --card-bg: #ffffff;
      --text-main: #16213e;
      --text-soft: #5c6275;
      --orange: #ffb443;
      --orange-soft: #ffd979;
      --green: #22c55e;
      --red: #ef4444;
      --yellow: #facc15;
      --border-soft: rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at top, #ffe9c7 0, #fdf6ec 40%, #fdf6ec 100%);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 1080px;
      margin: 24px auto 40px;
      padding: 0 16px;
    }

    header.app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .brand-block {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffe69b, #ffb443);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.14);
    }

    .brand-text h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 800;
      letter-spacing: 0.03em;
    }

    .brand-text span {
      display: block;
      font-size: 12px;
      color: var(--text-soft);
    }

    .top-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .today-label {
      font-size: 13px;
      color: var(--text-soft);
    }

    .nav-tabs {
      display: inline-flex;
      background: rgba(255, 255, 255, 0.8);
      padding: 4px;
      border-radius: 999px;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.12);
      backdrop-filter: blur(10px);
    }

    .nav-tab {
      border: none;
      padding: 6px 14px;
      border-radius: 999px;
      background: transparent;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-soft);
      font-weight: 600;
      transition: background 0.15s ease-out, color 0.15s ease-out,
        transform 0.15s ease-out;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #ffb443, #ffd979);
      color: #1f2933;
      transform: translateY(-1px);
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      padding: 16px 18px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-header h2 {
      font-size: 15px;
      margin: 0;
      font-weight: 700;
    }

    .card-header span {
      font-size: 12px;
      color: var(--text-soft);
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    /* ================== TASKS VIEW =================== */

    #tasks-view {
      display: block;
    }

    .dopamine-card-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .dopamine-card-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .dopamine-chart-container {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .dopamine-chart-wrapper {
      position: relative;
      width: 190px;
      height: 190px;
    }

    .dopamine-chart-wrapper svg {
      width: 100%;
      height: 100%;
    }

    .dopamine-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
    }

    .dopamine-center-main {
      font-size: 28px;
      font-weight: 800;
    }

    .dopamine-center-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    #dopamine-ring {
      transition: stroke-dashoffset 0.3s ease-out, stroke 0.3s ease-out;
    }

    .summary-row {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    .summary-item {
      background: #fff7e7;
      border-radius: 16px;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .summary-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .summary-value {
      font-size: 18px;
      font-weight: 800;
    }

    .summary-caption {
      font-size: 11px;
      color: var(--text-soft);
    }

    .task-flex {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .task-form-fields {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .task-form-fields input[type="text"] {
      flex: 1 1 160px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      font-size: 13px;
    }

    .task-form-fields select {
      padding: 8px 8px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      font-size: 13px;
      background: #fff;
    }

    .task-form-fields button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ffb443, #ffd979);
      color: #1f2933;
      box-shadow: 0 4px 10px rgba(248, 171, 46, 0.55);
      white-space: nowrap;
    }

    .task-list {
      border-top: 1px dashed rgba(148, 163, 184, 0.4);
      padding-top: 8px;
      max-height: 280px;
      overflow: auto;
    }

    table.tasks-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    table.tasks-table th,
    table.tasks-table td {
      padding: 6px 4px;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.16);
    }

    table.tasks-table th {
      font-weight: 600;
      font-size: 11px;
      color: var(--text-soft);
    }

    .task-title-input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      padding: 4px 6px;
      font-size: 12px;
      background: #ffffff;
    }

    .status-select {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 6px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: #fff;
    }

    .btn-delete-task {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      padding: 2px 4px;
    }

    .heatmap-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .heatmap-header small {
      font-size: 11px;
      color: var(--text-soft);
    }

    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 6px;
    }

    .heat-cell {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 5px;
      background: #e5e7eb;
      font-size: 9px;
      color: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
    }

    .heat-cell span {
      position: absolute;
      bottom: 2px;
      right: 3px;
      font-size: 8px;
      color: rgba(17, 24, 39, 0.6);
    }

    .heat-low {
      background: #fecaca;
    }

    .heat-mid {
      background: #fef9c3;
    }

    .heat-high {
      background: #bbf7d0;
    }

    .legend {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-soft);
      flex-wrap: wrap;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-swatch {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }

    .heatmap-empty-text {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* Floating Ho-Ho (Tasks) */
    .hoho-floating {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 170px;
      height: auto;
      cursor: grab;
      z-index: 50;
      filter: drop-shadow(0 10px 20px rgba(15, 23, 42, 0.35));
      user-select: none;
      -webkit-user-drag: none;
    }

    .hoho-floating:active {
      cursor: grabbing;
    }

    /* Floating Ho-Ho (Learning) */
    .hoho-learning-floating {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 150px;
      height: auto;
      z-index: 50;
      filter: drop-shadow(0 10px 20px rgba(15, 23, 42, 0.35));
      user-select: none;
      -webkit-user-drag: none;
      display: none;
    }

    /* ================== LEARNING VIEW =================== */

    #learning-view {
      display: none;
    }

    .learning-chart-card {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
    }

    .learning-chart-left {
      flex: 1 1 230px;
      min-width: 0;
    }

    .learning-chart-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .learning-chart-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .learning-chart-wrapper {
      position: relative;
      width: 170px;
      height: 170px;
      margin: 10px auto 6px;
    }

    .learning-chart-wrapper svg {
      width: 100%;
      height: 100%;
    }

    .learning-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
    }

    .learning-center-main {
      font-size: 24px;
      font-weight: 800;
    }

    .learning-center-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    #learning-ring {
      transition: stroke-dashoffset 0.3s ease-out, stroke 0.3s ease-out;
    }

    .learning-stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    .learning-stat {
      background: #fff7e7;
      border-radius: 16px;
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .learning-stat-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .learning-stat-value {
      font-size: 16px;
      font-weight: 800;
    }

    .learning-stat-caption {
      font-size: 11px;
      color: var(--text-soft);
    }

    .warning-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
      font-size: 11px;
      margin-top: 6px;
    }

    .skills-section-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .skills-section-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 8px;
      margin-bottom: 12px;
    }

    .skill-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      cursor: pointer;
      border: 1px solid transparent;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        border-color 0.12s ease-out, background 0.12s ease-out;
    }

    .skill-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.1);
      border-color: rgba(248, 171, 46, 0.65);
      background: #fffdf6;
    }

    .skill-icon {
      flex-shrink: 0;
      width: 46px;
      height: 46px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: 600;
      color: #1f2933;
      background: #f5f5f5;
    }

    .skill-info h3 {
      margin: 0 0 2px 0;
      font-size: 13px;
      font-weight: 700;
    }

    .skill-info p {
      margin: 0;
      font-size: 11px;
      color: var(--text-soft);
    }

    .skill-progress {
      margin-top: 4px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.18);
      overflow: hidden;
    }

    .skill-progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      transition: width 0.25s ease-out;
    }

    /* Hard skill icon colors */
    .icon-tools { background: linear-gradient(135deg, #bfe3ff, #e3f2ff); }
    .icon-digital { background: linear-gradient(135deg, #ffb443, #ffd979); }
    .icon-ai { background: linear-gradient(135deg, #dcd5ff, #f3e8ff); }
    .icon-creative { background: linear-gradient(135deg, #ffb6c9, #ffe0e9); }
    .icon-analytics { background: linear-gradient(135deg, #c8ffd7, #e6ffef); }
    .icon-finance { background: linear-gradient(135deg, #ffd979, #ffefc2); }
    .icon-hr { background: linear-gradient(135deg, #f3d9ff, #f8ecff); }
    .icon-sales { background: linear-gradient(135deg, #ff7e6e, #ffd1c7); }
    .icon-other { background: linear-gradient(135deg, #e0f4ff, #f0fbff); }

    /* Soft skills */
    .icon-cognitive { background: linear-gradient(135deg, #c8ffd7, #e9fff1); }
    .icon-interpersonal { background: linear-gradient(135deg, #ffb6c9, #ffe4f0); }
    .icon-intrapersonal { background: linear-gradient(135deg, #dcd5ff, #f2ecff); }
    .icon-business { background: linear-gradient(135deg, #ffb443, #ffe4b8); }
    .icon-leadership { background: linear-gradient(135deg, #ffe27a, #fff3c4); }

    .learning-history {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
    }

    .learning-card {
      border-radius: 16px;
      background: #ffffff;
      padding: 10px 12px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
      font-size: 11px;
    }

    .learning-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 4px;
    }

    .learning-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff7e7;
      font-size: 10px;
    }

    .learning-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 10px;
    }

    .learning-actions-row {
      display: flex;
      gap: 4px;
    }

    .learning-action-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 11px;
      padding: 0;
      color: #6b7280;
      text-decoration: underline;
    }

    .learning-card p {
      margin: 0;
      font-size: 11px;
      color: var(--text-soft);
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding: 16px;
      z-index: 30;
    }

    .modal-backdrop.hidden {
      display: none;
    }

    .modal {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.35);
      animation: popIn 0.22s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes popIn {
      from {
        transform: translateY(12px) scale(0.92);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 14px;
      font-weight: 700;
    }

    .modal-header button {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 12px;
    }

    .modal-body label {
      font-size: 11px;
      font-weight: 600;
    }

    .modal-body textarea {
      width: 100%;
      min-height: 56px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 6px 8px;
      font-size: 12px;
      resize: vertical;
    }

    .effort-options {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 3px;
    }

    .effort-chip {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      cursor: pointer;
      background: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .effort-chip.active {
      border-color: rgba(248, 171, 46, 0.9);
      background: #fff7e7;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      gap: 6px;
    }

    .btn-primary {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #ffb443, #ffd979);
      color: #1f2933;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(248, 171, 46, 0.6);
    }

    .btn-secondary {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      background: #ffffff;
      color: var(--text-soft);
      cursor: pointer;
    }

    @media (max-width: 640px) {
      header.app-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .top-right {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="brand-block">
        <div class="brand-avatar">‚ú®</div>
        <div class="brand-text">
          <h1>HeyHoLetsGo</h1>
          <span>Dopamine-based work & learning tracker</span>
        </div>
      </div>
      <div class="top-right">
        <div class="today-label" id="today-label"></div>
        <div class="nav-tabs">
          <button class="nav-tab active" data-view="tasks-view">Tasks</button>
          <button class="nav-tab" data-view="learning-view">Learning & Skills</button>
        </div>
      </div>
    </header>

    <main>
      <!-- ============== TASKS VIEW ============== -->
      <section id="tasks-view">
        <div class="card">
          <div class="card-header">
            <h2>Today‚Äôs Dopamine Sparks</h2>
            <span>‚ÄúGood day‚Äù kalau udah tembus ‚â• 60%.</span>
          </div>
          <div class="dopamine-card-title" id="dopamine-title">
            Let‚Äôs warm up this day.
          </div>
          <div class="dopamine-card-sub" id="dopamine-sub">
            Ngerjain beberapa task meaningful sampai minimal 60% ‚Äî baru berasa enak di otak.
          </div>

          <div class="dopamine-chart-container">
            <div class="dopamine-chart-wrapper">
              <svg viewBox="0 0 160 160">
                <circle
                  cx="80"
                  cy="80"
                  r="60"
                  stroke="rgba(209,213,219,0.8)"
                  stroke-width="14"
                  fill="none"
                  stroke-linecap="round"
                ></circle>
                <circle
                  id="dopamine-ring"
                  cx="80"
                  cy="80"
                  r="60"
                  stroke="#22c55e"
                  stroke-width="14"
                  fill="none"
                  stroke-linecap="round"
                  stroke-dasharray="377"
                  stroke-dashoffset="377"
                  transform="rotate(-90 80 80)"
                ></circle>
              </svg>
              <div class="dopamine-center">
                <div class="dopamine-center-main" id="dopamine-percent">0%</div>
                <div class="dopamine-center-sub">dopamine sparks today</div>
              </div>
            </div>

            <div class="summary-row">
              <div class="summary-item">
                <span class="summary-label">Dopamine Sparks</span>
                <span class="summary-value" id="today-score">0%</span>
                <span class="summary-caption" id="score-caption">Belum mulai, masih loading.</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Tasks Done</span>
                <span class="summary-value" id="tasks-done">0</span>
                <span class="summary-caption" id="tasks-done-caption">Completed today.</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">XP from Tasks</span>
                <span class="summary-value" id="tasks-xp">0</span>
                <span class="summary-caption">Semakin berat task, XP makin tinggi.</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Tasks & Progress</h2>
            <span>Track yang penting aja, tanpa micromanage.</span>
          </div>
          <div class="task-flex">
            <form id="task-form">
              <div class="task-form-fields">
                <input
                  type="text"
                  id="task-title"
                  placeholder="What are you working on?"
                  required
                />
                <select id="task-effort">
                  <option value="1">Effort 1 ‚Äì Small</option>
                  <option value="2">Effort 2 ‚Äì Medium</option>
                  <option value="3">Effort 3 ‚Äì Heavy</option>
                </select>
                <button type="submit">Add Task</button>
              </div>
            </form>

            <div class="task-list">
              <table class="tasks-table">
                <thead>
                  <tr>
                    <th>Task</th>
                    <th>Effort</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="tasks-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="heatmap-header">
            <div>
              <h2 style="margin:0;font-size:14px;">Productivity Heatmap (Last 28 Days)</h2>
              <small>Heatmap muncul cuma di hari yang ada data. Klik untuk lihat detail.</small>
            </div>
          </div>
          <div id="heatmap-grid" class="heatmap-grid"></div>
          <div id="heatmap-empty-text" class="heatmap-empty-text" style="display:none;">
            Belum ada history task. Begitu lo mulai isi hari ini, kotak-kotak bakal muncul pelan-pelan.
          </div>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-swatch" style="background:#fecaca;"></div> <span>0‚Äì39%</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#fef9c3;"></div> <span>40‚Äì79%</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#bbf7d0;"></div> <span>80‚Äì100%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ============== LEARNING VIEW ============== -->
      <section id="learning-view">
        <div class="card">
          <div class="card-header">
            <h2>Learning & Skills</h2>
            <span>Minimal 1 insight/hari untuk compound growth.</span>
          </div>

          <div class="learning-chart-card">
            <div class="learning-chart-left">
              <div class="learning-chart-title" id="learning-title">
                Today‚Äôs Learning Dose
              </div>
              <div class="learning-chart-sub" id="learning-sub">
                Target harian: 5 XP dari belajar (video, artikel, diskusi, dll).
              </div>

              <div class="learning-chart-wrapper">
                <svg viewBox="0 0 160 160">
                  <circle
                    cx="80"
                    cy="80"
                    r="60"
                    stroke="rgba(209,213,219,0.8)"
                    stroke-width="14"
                    fill="none"
                    stroke-linecap="round"
                  ></circle>
                  <circle
                    id="learning-ring"
                    cx="80"
                    cy="80"
                    r="60"
                    stroke="#22c55e"
                    stroke-width="14"
                    fill="none"
                    stroke-linecap="round"
                    stroke-dasharray="377"
                    stroke-dashoffset="377"
                    transform="rotate(-90 80 80)"
                  ></circle>
                </svg>
                <div class="learning-center">
                  <div class="learning-center-main" id="learning-percent">0%</div>
                  <div class="learning-center-sub">of today‚Äôs learning target</div>
                </div>
              </div>

              <div class="learning-stats-row">
                <div class="learning-stat">
                  <span class="learning-stat-label">Today‚Äôs Learning XP</span>
                  <span class="learning-stat-value" id="learning-xp-today">0</span>
                  <span class="learning-stat-caption">Dari insight yang lo log hari ini.</span>
                </div>
                <div class="learning-stat">
                  <span class="learning-stat-label">Total Learning XP (6 months)</span>
                  <span class="learning-stat-value" id="learning-xp-total">0</span>
                  <span class="learning-stat-caption">Across all skills.</span>
                </div>
                <div class="learning-stat">
                  <span class="learning-stat-label">Learning Streak</span>
                  <span class="learning-stat-value" id="learning-streak">0 days</span>
                  <span class="learning-stat-caption">Hari beruntun isi learning.</span>
                </div>
              </div>

              <div id="learning-warning" class="warning-chip" style="display:none;">
                ‚ö†Ô∏è Today has no learning entry yet. Ho-Ho mau minimal 1 insight.
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="heatmap-header">
            <div>
              <h2 style="margin:0;font-size:14px;">Learning Heatmap (Last 28 Days)</h2>
              <small>Kotak muncul hanya di hari yang ada learning. Klik buat lihat insight-nya.</small>
            </div>
          </div>
          <div id="learning-heatmap-grid" class="heatmap-grid"></div>
          <div id="learning-heatmap-empty-text" class="heatmap-empty-text" style="display:none;">
            Belum ada learning yang di-log. Isi satu aja hari ini, heatmap bakal mulai terbentuk.
          </div>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-swatch" style="background:#fecaca;"></div> <span>0‚Äì39% target</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#fef9c3;"></div> <span>40‚Äì79%</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#bbf7d0;"></div> <span>80‚Äì100%</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="skills-section-title">Hard Skills</div>
          <div class="skills-section-sub">
            Pilih area yang lo kembangin hari ini, lalu catat insight barunya.
          </div>
          <div class="skills-grid">
            <div
              class="skill-card"
              data-skill-id="tools"
              data-skill-name="Tools & Workspace"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-tools">üß∞</div>
              <div class="skill-info">
                <h3>Tools & Workspace</h3>
                <p>Google Sheets, Lark, Canva, Capcut, dsb.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="tools"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="digital"
              data-skill-name="Digital Marketing"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-digital">üì£</div>
              <div class="skill-info">
                <h3>Digital Marketing</h3>
                <p>Meta Ads, TikTok Ads, Google Ads, SEO.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="digital"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="ai"
              data-skill-name="AI Skills"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-ai">ü§ñ</div>
              <div class="skill-info">
                <h3>AI Skills</h3>
                <p>ChatGPT prompting, AI coding, AI content.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="ai"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="creative"
              data-skill-name="Content & Creative"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-creative">üé®</div>
              <div class="skill-info">
                <h3>Content & Creative</h3>
                <p>Audience, copy, storytelling, campaigns.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="creative"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="analytics"
              data-skill-name="Data Analytics & Research"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-analytics">üìä</div>
              <div class="skill-info">
                <h3>Data Analytics & Research</h3>
                <p>Competitor, trend, funnel, industry.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="analytics"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="finance"
              data-skill-name="Finance"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-finance">üí∞</div>
              <div class="skill-info">
                <h3>Finance</h3>
                <p>Tax, financial audit, budgeting.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="finance"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="hr"
              data-skill-name="HR"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-hr">üßë‚Äçüíº</div>
              <div class="skill-info">
                <h3>HR</h3>
                <p>Recruitment, performance, legal HR.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="hr"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="sales"
              data-skill-name="Sales"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-sales">üìà</div>
              <div class="skill-info">
                <h3>Sales</h3>
                <p>Prospecting, closing, follow-up.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="sales"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="others"
              data-skill-name="Others"
              data-skill-type="hard"
            >
              <div class="skill-icon icon-other">‚ú®</div>
              <div class="skill-info">
                <h3>Others</h3>
                <p>Skill lain di luar kategori utama.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="others"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="skills-section-title">Soft Skills</div>
          <div class="skills-section-sub">
            Mindset & cara mikir lo yang bikin karier bisa ngebut.
          </div>
          <div class="skills-grid">
            <div
              class="skill-card"
              data-skill-id="cognitive"
              data-skill-name="Cognitive"
              data-skill-type="soft"
            >
              <div class="skill-icon icon-cognitive">üß†</div>
              <div class="skill-info">
                <h3>Cognitive</h3>
                <p>Analytical, structured, system, strategic.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="cognitive"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="interpersonal"
              data-skill-name="Interpersonal"
              data-skill-type="soft"
            >
              <div class="skill-icon icon-interpersonal">ü§ù</div>
              <div class="skill-info">
                <h3>Interpersonal</h3>
                <p>Communication, conflict, negotiation.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="interpersonal"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="intrapersonal"
              data-skill-name="Intrapersonal"
              data-skill-type="soft"
            >
              <div class="skill-icon icon-intrapersonal">üå±</div>
              <div class="skill-info">
                <h3>Intrapersonal</h3>
                <p>Growth mindset, focus, resilience.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="intrapersonal"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="business"
              data-skill-name="Business Acumen"
              data-skill-type="soft"
            >
              <div class="skill-icon icon-business">üìä</div>
              <div class="skill-info">
                <h3>Business Acumen</h3>
                <p>Finance, market, risk & opportunity.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="business"></div>
                </div>
              </div>
            </div>

            <div
              class="skill-card"
              data-skill-id="leadership"
              data-skill-name="Leadership & Management"
              data-skill-type="soft"
            >
              <div class="skill-icon icon-leadership">‚≠ê</div>
              <div class="skill-info">
                <h3>Leadership & Management</h3>
                <p>Vision, influence, mentoring.</p>
                <div class="skill-progress">
                  <div class="skill-progress-fill" data-progress-for="leadership"></div>
                </div>
              </div>
            </div>
          </div>

          <div style="font-size:11px;color:var(--text-soft);margin-top:6px;">
            History insight terbaru:
          </div>
          <div id="learning-history" class="learning-history"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Floating Ho-Ho (Tasks) -->
  <img
    id="hoho-floating"
    src="hoho-happy.png"
    alt="Ho-Ho Tasks"
    class="hoho-floating"
  />

  <!-- Floating Ho-Ho (Learning) -->
  <img
    id="hoho-learning-floating"
    src="hoho-book.png"
    alt="Ho-Ho Learning"
    class="hoho-learning-floating"
  />

  <!-- Learning Modal -->
  <div id="learning-modal-backdrop" class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h3 id="modal-skill-title">Log Learning</h3>
          <small id="modal-skill-sub" style="font-size:11px;color:var(--text-soft);"></small>
        </div>
        <button type="button" id="modal-close-btn">√ó</button>
      </div>
      <div class="modal-body">
        <div>
          <label for="learning-what">Apa yang lo pelajarin?</label>
          <textarea id="learning-what" placeholder="Tulis insight atau skill yang lo dapet hari ini..."></textarea>
        </div>
        <div>
          <label for="learning-benefit">Manfaatnya buat kerja lo?</label>
          <textarea id="learning-benefit" placeholder="Contoh: bikin revisi ke KOL lebih smooth, bikin konten lebih kebayang, dll."></textarea>
        </div>
        <div>
          <label>Effort (durasi / kedalaman belajar)</label>
          <div class="effort-options" id="effort-options">
            <div class="effort-chip" data-effort="small">üå± Small (5‚Äì10 menit)</div>
            <div class="effort-chip" data-effort="medium">üî• Medium (deep dive)</div>
            <div class="effort-chip" data-effort="intensive">üöÄ Intensive (1‚Äì2 jam)</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="modal-cancel-btn">Cancel</button>
        <button class="btn-primary" id="modal-save-btn">Save Learning</button>
      </div>
    </div>
  </div>

  <!-- Heatmap Day Detail Modal (Tasks) -->
  <div id="day-modal-backdrop" class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h3 id="day-modal-title">Day Details</h3>
          <small id="day-modal-sub" style="font-size:11px;color:var(--text-soft);"></small>
        </div>
        <button type="button" id="day-modal-close-btn">√ó</button>
      </div>
      <div class="modal-body" id="day-modal-body"></div>
    </div>
  </div>

  <!-- Heatmap Day Detail Modal (Learning) -->
  <div id="learning-day-modal-backdrop" class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h3 id="learning-day-modal-title">Learning Details</h3>
          <small id="learning-day-modal-sub" style="font-size:11px;color:var(--text-soft);"></small>
        </div>
        <button type="button" id="learning-day-modal-close-btn">√ó</button>
      </div>
      <div class="modal-body" id="learning-day-modal-body"></div>
    </div>
  </div>

  <script>
    // ------------------- Utility ----------------------------------
    function formatDateISO(date) {
      return date.toISOString().slice(0, 10);
    }

    function todayISO() {
      return formatDateISO(new Date());
    }

    function parseISO(dateStr) {
      const [y, m, d] = dateStr.split("-").map(Number);
      return new Date(y, m - 1, d);
    }

    const STORAGE_TASKS = "heyho_tasks_v1";
    const STORAGE_LEARNING = "heyho_learning_v1";

    let tasksState = { days: {} };
    let learningState = { entries: [] };

    function loadState() {
      try {
        const rawTasks = localStorage.getItem(STORAGE_TASKS);
        if (rawTasks) tasksState = JSON.parse(rawTasks);
      } catch (e) {
        console.error("Error loading tasks:", e);
      }
      try {
        const rawLearn = localStorage.getItem(STORAGE_LEARNING);
        if (rawLearn) learningState = JSON.parse(rawLearn);
      } catch (e) {
        console.error("Error loading learning:", e);
      }
    }

    function saveTasks() {
      localStorage.setItem(STORAGE_TASKS, JSON.stringify(tasksState));
    }

    function saveLearning() {
      localStorage.setItem(STORAGE_LEARNING, JSON.stringify(learningState));
    }

    // ------------------- Tasks Logic ------------------------------
    function ensureDay(dateStr) {
      if (!tasksState.days[dateStr]) {
        tasksState.days[dateStr] = { tasks: [] };
      }
      return tasksState.days[dateStr];
    }

    function computeDayScore(dayData) {
      const tasks = dayData.tasks || [];
      let totalEffort = 0;
      let gainedEffort = 0;
      let doneCount = 0;
      tasks.forEach((t) => {
        const eff = Number(t.effort || 1);
        totalEffort += eff;
        if (t.status === "done") {
          gainedEffort += eff;
          doneCount++;
        } else if (t.status === "progress") {
          gainedEffort += eff * 0.2;
        }
      });
      const score = totalEffort > 0 ? Math.round((gainedEffort / totalEffort) * 100) : 0;
      return {
        score,
        doneCount,
        xp: Math.round(gainedEffort * 10)
      };
    }

    function updateDopamineChart(score) {
      const ring = document.getElementById("dopamine-ring");
      const percentEl = document.getElementById("dopamine-percent");
      const titleEl = document.getElementById("dopamine-title");
      const subEl = document.getElementById("dopamine-sub");
      const hoho = document.getElementById("hoho-floating");

      const clamped = Math.max(0, Math.min(100, score));
      const circumference = 377;

      if (ring) {
        const offset = circumference * (1 - clamped / 100);
        ring.style.strokeDashoffset = offset;
        const hue = 30 + (clamped / 100) * 90;
        ring.style.stroke = `hsl(${hue}, 90%, 55%)`;
      }
      if (percentEl) percentEl.textContent = clamped + "%";

      let title = "Let‚Äôs warm up this day.";
      let sub =
        "Ngerjain beberapa task meaningful sampai minimal 60% ‚Äî baru berasa enak di otak.";
      let hohoSrc = "hoho-happy.png";

      if (clamped === 0) {
        title = "Blank canvas. You‚Äôre one task away.";
        sub = "Mulai dari 1 small task aja dulu.";
        hohoSrc = "hoho-sad.png";
      } else if (clamped < 40) {
        title = "You‚Äôve started. Keep going.";
        sub = "Tambah 1‚Äì2 task lagi biar mulai kerasa.";
        hohoSrc = "hoho-thinking.png";
      } else if (clamped < 60) {
        title = "Momentum udah kebentuk.";
        sub = "Dikit lagi tembus 60%. Pilih satu task yang meaningful.";
        hohoSrc = "hoho-pointsmile.png";
      } else if (clamped < 80) {
        title = "Good day unlocked.";
        sub = "Lo udah lewat target 60%. Gas dikit lagi kalau mau.";
        hohoSrc = "hoho-happy.png";
      } else {
        title = "Max dopamine mode. üî•";
        sub = "Besok boleh slow dikit, tapi streaknya jangan putus.";
        hohoSrc = "hoho-levelup.png";
      }

      if (titleEl) titleEl.textContent = title;
      if (subEl) subEl.textContent = sub;
      if (hoho) hoho.src = hohoSrc;
    }

    function renderTodaySummary() {
      const today = todayISO();
      const day = ensureDay(today);
      const { score, doneCount, xp } = computeDayScore(day);
      document.getElementById("today-score").textContent = score + "%";
      document.getElementById("tasks-done").textContent = doneCount;
      document.getElementById("tasks-xp").textContent = xp;

      let caption = "Belum mulai, masih loading.";
      if (score >= 80) caption = "Satisfying AF. Keep this energy.";
      else if (score >= 60) caption = "Good day. Lo udah lewat 60%.";
      else if (score >= 40) caption = "Nice momentum, 1‚Äì2 task lagi buat tembus 60%.";
      else if (score > 0) caption = "Warm-up mode. You‚Äôve started, keep going.";
      document.getElementById("score-caption").textContent = caption;

      updateDopamineChart(score);
    }

    function renderTasksList() {
      const today = todayISO();
      const day = ensureDay(today);
      const tbody = document.getElementById("tasks-body");
      tbody.innerHTML = "";
      day.tasks.forEach((t) => {
        const tr = document.createElement("tr");

        // Title (editable only for today, and ini emang list hari ini)
        const tdTitle = document.createElement("td");
        const inputTitle = document.createElement("input");
        inputTitle.type = "text";
        inputTitle.value = t.title || "";
        inputTitle.className = "task-title-input";
        inputTitle.addEventListener("change", () => {
          t.title = inputTitle.value.trim();
          saveTasks();
        });
        tdTitle.appendChild(inputTitle);
        tr.appendChild(tdTitle);

        // Effort (editable)
        const tdEff = document.createElement("td");
        const selectEff = document.createElement("select");
        selectEff.className = "status-select";
        [["1", "Effort 1"], ["2", "Effort 2"], ["3", "Effort 3"]].forEach(
          ([val, label]) => {
            const opt = document.createElement("option");
            opt.value = val;
            opt.textContent = label;
            if (t.effort === val) opt.selected = true;
            selectEff.appendChild(opt);
          }
        );
        selectEff.addEventListener("change", () => {
          t.effort = selectEff.value;
          saveTasks();
          renderTodaySummary();
          renderHeatmap();
        });
        tdEff.appendChild(selectEff);
        tr.appendChild(tdEff);

        // Status
        const tdStatus = document.createElement("td");
        const select = document.createElement("select");
        select.className = "status-select";
        ["none", "progress", "done", "blocked"].forEach((status) => {
          const opt = document.createElement("option");
          opt.value = status;
          opt.textContent =
            status === "none"
              ? "Not started"
              : status.charAt(0).toUpperCase() + status.slice(1);
          if (t.status === status) opt.selected = true;
          select.appendChild(opt);
        });
        select.addEventListener("change", () => {
          t.status = select.value;
          saveTasks();
          renderTodaySummary();
          renderHeatmap();
        });
        tdStatus.appendChild(select);
        tr.appendChild(tdStatus);

        // Actions (delete only today ‚Äì dan memang list ini hari ini)
        const tdActions = document.createElement("td");
        const delBtn = document.createElement("button");
        delBtn.className = "btn-delete-task";
        delBtn.title = "Delete task";
        delBtn.textContent = "üóë";
        delBtn.addEventListener("click", () => {
          day.tasks = day.tasks.filter((x) => x.id !== t.id);
          saveTasks();
          renderTasksList();
          renderTodaySummary();
          renderHeatmap();
        });
        tdActions.appendChild(delBtn);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });
    }

    function handleTaskFormSubmit(evt) {
      evt.preventDefault();
      const titleInput = document.getElementById("task-title");
      const effortSelect = document.getElementById("task-effort");
      const title = titleInput.value.trim();
      if (!title) return;
      const effort = effortSelect.value;
      const today = todayISO();
      const day = ensureDay(today);
      day.tasks.push({
        id: Date.now() + "_" + Math.random().toString(16).slice(2),
        title,
        effort,
        status: "none"
      });
      saveTasks();
      titleInput.value = "";
      renderTasksList();
      renderTodaySummary();
      renderHeatmap();
    }

    // ------------------- Heatmap (Tasks) --------------------------
    function renderHeatmap() {
      const grid = document.getElementById("heatmap-grid");
      const emptyText = document.getElementById("heatmap-empty-text");
      grid.innerHTML = "";

      const allDates = Object.keys(tasksState.days || {});
      if (allDates.length === 0) {
        emptyText.style.display = "block";
        return;
      }
      emptyText.style.display = "none";

      allDates.sort(); // ISO string sort
      const lastDates = allDates.slice(-28);

      lastDates.forEach((iso) => {
        const d = parseISO(iso);
        const dayData = tasksState.days[iso];
        const { score } = computeDayScore(dayData);
        const cell = document.createElement("div");
        cell.className = "heat-cell";
        if (score < 40) cell.classList.add("heat-low");
        else if (score < 80) cell.classList.add("heat-mid");
        else cell.classList.add("heat-high");

        const label = document.createElement("span");
        label.textContent = d.getDate();
        cell.appendChild(label);

        cell.addEventListener("click", () => openDayModal(iso, score));
        grid.appendChild(cell);
      });
    }

    function openDayModal(dateStr, score) {
      const modalBackdrop = document.getElementById("day-modal-backdrop");
      const titleEl = document.getElementById("day-modal-title");
      const subEl = document.getElementById("day-modal-sub");
      const bodyEl = document.getElementById("day-modal-body");

      const d = parseISO(dateStr);
      const options = { weekday: "short", day: "numeric", month: "short" };
      titleEl.textContent = d.toLocaleDateString(undefined, options);
      subEl.textContent = "Dopamine sparks: " + score + "%";

      const day = tasksState.days[dateStr];
      bodyEl.innerHTML = "";
      if (!day || day.tasks.length === 0) {
        bodyEl.innerHTML =
          "<p style='font-size:12px;color:#6b7280;'>No tasks logged on this day. Mungkin belum ke-input atau memang hari santai.</p>";
      } else {
        const list = document.createElement("ul");
        list.style.paddingLeft = "18px";
        list.style.fontSize = "12px";
        day.tasks.forEach((t) => {
          const li = document.createElement("li");
          const statusLabel =
            t.status === "done"
              ? "‚úÖ"
              : t.status === "progress"
              ? "üü°"
              : t.status === "blocked"
              ? "‚õî"
              : "‚¨ú";
          li.textContent =
            statusLabel +
            " [E" +
            t.effort +
            "] " +
            (t.title || "(No title)");
          list.appendChild(li);
        });
        bodyEl.appendChild(list);
      }
      modalBackdrop.classList.remove("hidden");
    }

    // ------------------- Learning Logic ---------------------------
    const EFFORT_XP = { small: 1, medium: 3, intensive: 6 };
    const EFFORT_PROGRESS = { small: 5, medium: 10, intensive: 15 };

    function logLearningEntry(entry) {
      learningState.entries.push(entry);
      saveLearning();
    }

    function getSixMonthsAgoISO() {
      const d = new Date();
      d.setMonth(d.getMonth() - 6);
      return formatDateISO(d);
    }

    function updateLearningHoHo(todayXP) {
      const hohoL = document.getElementById("hoho-learning-floating");
      if (!hohoL) return;
      if (todayXP === 0) {
        hohoL.src = "hoho-thinking.png";
      } else if (todayXP < 5) {
        hohoL.src = "hoho-book.png";
      } else {
        hohoL.src = "hoho-levelup.png";
      }
    }

    function updateLearningChart(todayXP) {
      const ring = document.getElementById("learning-ring");
      const percentEl = document.getElementById("learning-percent");
      const titleEl = document.getElementById("learning-title");
      const subEl = document.getElementById("learning-sub");

      const target = 5;
      const ratio = target > 0 ? Math.min(1, todayXP / target) : 0;
      const percent = Math.round(ratio * 100);
      const circumference = 377;

      if (ring) {
        const offset = circumference * (1 - percent / 100);
        ring.style.strokeDashoffset = offset;
        const hue = 40 + ratio * 80;
        ring.style.stroke = `hsl(${hue}, 90%, 55%)`;
      }
      if (percentEl) percentEl.textContent = percent + "%";

      let title = "Today‚Äôs Learning Dose";
      let sub = "Target harian: 5 XP dari belajar (video, artikel, diskusi, dll).";

      if (todayXP === 0) {
        title = "No learning logged (yet).";
        sub = "Ambil 1 video / artikel / diskusi kecil, lalu tulis insight-nya.";
      } else if (todayXP < 5) {
        title = "Nice, otak udah kepancing.";
        sub = "Satu insight lagi bisa nutup target harian.";
      } else if (todayXP < 10) {
        title = "Learning target tercapai.";
        sub = "Kalau lagi mood, gas dikit lagi buat bonus XP.";
      } else {
        title = "Deep learning mode. üî•";
        sub = "Jangan lupa istirahat, otak juga butuh cooldown.";
      }

      if (titleEl) titleEl.textContent = title;
      if (subEl) subEl.textContent = sub;

      updateLearningHoHo(todayXP);
    }

    function renderLearningStatsAndProgress() {
      const today = todayISO();
      const sixMonthsAgo = getSixMonthsAgoISO();
      const entries = learningState.entries || [];

      let todayXP = 0;
      let totalXP = 0;
      const progressBySkill = {};
      const datesWithLearning = new Set();

      entries.forEach((e) => {
        const date = e.date;
        const xp = Number(e.xp || 0);
        if (date === today) todayXP += xp;
        if (date >= sixMonthsAgo) {
          totalXP += xp;
          const key = e.skillId;
          const inc = EFFORT_PROGRESS[e.effort] || 0;
          progressBySkill[key] = (progressBySkill[key] || 0) + inc;
          datesWithLearning.add(date);
        }
      });

      Object.keys(progressBySkill).forEach((k) => {
        progressBySkill[k] = Math.min(100, progressBySkill[k]);
      });

      document.getElementById("learning-xp-today").textContent = todayXP;
      document.getElementById("learning-xp-total").textContent = totalXP;

      // streak
      let streak = 0;
      let cursor = new Date();
      while (true) {
        const iso = formatDateISO(cursor);
        if (datesWithLearning.has(iso)) {
          streak++;
          cursor.setDate(cursor.getDate() - 1);
        } else {
          break;
        }
      }
      document.getElementById("learning-streak").textContent =
        streak + (streak === 1 ? " day" : " days");

      const warningEl = document.getElementById("learning-warning");
      warningEl.style.display = todayXP === 0 ? "inline-flex" : "none";

      // progress bars
      const fills = document.querySelectorAll(".skill-progress-fill");
      fills.forEach((el) => {
        const skillId = el.dataset.progressFor;
        const value = progressBySkill[skillId] || 0;
        el.style.width = value + "%";
        const hue = 10 + (value / 100) * 80;
        el.style.background = `linear-gradient(90deg, hsl(${hue},90%,60%), hsl(${hue + 20},90%,55%))`;
      });

      updateLearningChart(todayXP);
    }

    function renderLearningHistory() {
      const container = document.getElementById("learning-history");
      container.innerHTML = "";
      const entries = [...(learningState.entries || [])];
      entries.sort((a, b) => (a.date < b.date ? 1 : -1));
      const recent = entries.slice(0, 8);
      if (recent.length === 0) {
        container.innerHTML =
          "<p style='font-size:11px;color:#6b7280;'>Belum ada learning yang dicatat. Mulai dengan 1 insight kecil hari ini.</p>";
        return;
      }
      const today = todayISO();
      recent.forEach((e) => {
        const card = document.createElement("div");
        card.className = "learning-card";
        const header = document.createElement("div");
        header.className = "learning-card-header";

        const left = document.createElement("div");
        left.innerHTML =
          "<strong>" +
          e.skillName +
          "</strong><br><span style='font-size:10px;color:#6b7280;'>" +
          e.date +
          "</span>";

        const right = document.createElement("div");
        right.className = "learning-actions";

        const tag = document.createElement("div");
        tag.className = "learning-tag";
        const effortLabel =
          e.effort === "small"
            ? "Small"
            : e.effort === "medium"
            ? "Medium"
            : "Intensive";
        tag.textContent = effortLabel + " ‚Ä¢ +" + e.xp + " XP";
        right.appendChild(tag);

        if (e.date === today) {
          const actionsRow = document.createElement("div");
          actionsRow.className = "learning-actions-row";
          const editBtn = document.createElement("button");
          editBtn.className = "learning-action-btn";
          editBtn.textContent = "Edit";
          editBtn.addEventListener("click", () => {
            openLearningModal(e.skillId, e.skillName, e.skillType, e);
          });
          const delBtn = document.createElement("button");
          delBtn.className = "learning-action-btn";
          delBtn.textContent = "Delete";
          delBtn.addEventListener("click", () => {
            deleteLearningEntry(e.id);
          });
          actionsRow.appendChild(editBtn);
          actionsRow.appendChild(delBtn);
          right.appendChild(actionsRow);
        }

        header.appendChild(left);
        header.appendChild(right);

        const pWhat = document.createElement("p");
        pWhat.textContent = e.what || "";
        const pBenefit = document.createElement("p");
        pBenefit.textContent = "‚Üí " + (e.benefit || "");

        card.appendChild(header);
        card.appendChild(pWhat);
        card.appendChild(pBenefit);

        container.appendChild(card);
      });
    }

    function deleteLearningEntry(id) {
      learningState.entries = (learningState.entries || []).filter(
        (e) => e.id !== id
      );
      saveLearning();
      renderLearningStatsAndProgress();
      renderLearningHistory();
      renderLearningHeatmap();
    }

    // ------------------- Learning Heatmap -------------------------
    function getLearningXPForDate(dateStr) {
      let xp = 0;
      (learningState.entries || []).forEach((e) => {
        if (e.date === dateStr) {
          xp += Number(e.xp || 0);
        }
      });
      return xp;
    }

    function renderLearningHeatmap() {
      const grid = document.getElementById("learning-heatmap-grid");
      const emptyText = document.getElementById(
        "learning-heatmap-empty-text"
      );
      grid.innerHTML = "";

      const allDatesSet = new Set();
      (learningState.entries || []).forEach((e) => {
        allDatesSet.add(e.date);
      });
      const allDates = Array.from(allDatesSet);
      if (allDates.length === 0) {
        emptyText.style.display = "block";
        return;
      }
      emptyText.style.display = "none";

      allDates.sort();
      const lastDates = allDates.slice(-28);

      lastDates.forEach((iso) => {
        const d = parseISO(iso);
        const xp = getLearningXPForDate(iso);
        const targetXP = 5;
        const ratio = targetXP > 0 ? Math.min(1, xp / targetXP) : 0;
        const score = Math.round(ratio * 100);

        const cell = document.createElement("div");
        cell.className = "heat-cell";
        if (score === 0) cell.classList.add("heat-low");
        else if (score < 80) cell.classList.add("heat-mid");
        else cell.classList.add("heat-high");

        const label = document.createElement("span");
        label.textContent = d.getDate();
        cell.appendChild(label);

        cell.addEventListener("click", () =>
          openLearningDayModal(iso, xp, score)
        );

        grid.appendChild(cell);
      });
    }

    function openLearningDayModal(dateStr, xp, score) {
      const modalBackdrop = document.getElementById(
        "learning-day-modal-backdrop"
      );
      const titleEl = document.getElementById("learning-day-modal-title");
      const subEl = document.getElementById("learning-day-modal-sub");
      const bodyEl = document.getElementById("learning-day-modal-body");

      const d = parseISO(dateStr);
      const options = { weekday: "short", day: "numeric", month: "short" };
      titleEl.textContent = d.toLocaleDateString(undefined, options);
      subEl.textContent = "XP: " + xp + " ‚Ä¢ " + score + "% of daily target";

      const entries = (learningState.entries || []).filter(
        (e) => e.date === dateStr
      );
      bodyEl.innerHTML = "";
      if (entries.length === 0) {
        bodyEl.innerHTML =
          "<p style='font-size:12px;color:#6b7280;'>No learning logged on this day.</p>";
      } else {
        const list = document.createElement("ul");
        list.style.paddingLeft = "18px";
        list.style.fontSize = "12px";
        entries.forEach((e) => {
          const li = document.createElement("li");
          li.textContent =
            "[" +
            e.skillName +
            "] +" +
            e.xp +
            " XP ‚Äì " +
            (e.what || "").slice(0, 80);
          list.appendChild(li);
        });
        bodyEl.appendChild(list);
      }
      modalBackdrop.classList.remove("hidden");
    }

    // ------------------- Learning Modal ---------------------------
    let currentSkillContext = null;
    let currentEffort = "small";
    let editingEntryId = null;

    function openLearningModal(skillId, skillName, skillType, existingEntry) {
      currentSkillContext = { skillId, skillName, skillType };

      const titleEl = document.getElementById("modal-skill-title");
      const subEl = document.getElementById("modal-skill-sub");
      const whatEl = document.getElementById("learning-what");
      const benefitEl = document.getElementById("learning-benefit");

      if (existingEntry) {
        editingEntryId = existingEntry.id;
        whatEl.value = existingEntry.what || "";
        benefitEl.value = existingEntry.benefit || "";
        currentEffort = existingEntry.effort || "small";
        titleEl.textContent = "Edit Learning ‚Äì " + skillName;
      } else {
        editingEntryId = null;
        whatEl.value = "";
        benefitEl.value = "";
        currentEffort = "small";
        titleEl.textContent = "Log Learning ‚Äì " + skillName;
      }

      subEl.textContent =
        skillType === "hard"
          ? "Hard skill: bikin lo makin tajem di kerjaan teknis."
          : "Soft skill: cara lo mikir & berinteraksi sama orang.";

      const chips = document.querySelectorAll(".effort-chip");
      chips.forEach((chip) => {
        chip.classList.toggle("active", chip.dataset.effort === currentEffort);
      });

      document
        .getElementById("learning-modal-backdrop")
        .classList.remove("hidden");
    }

    function closeLearningModal() {
      document
        .getElementById("learning-modal-backdrop")
        .classList.add("hidden");
    }

    function handleEffortClick(e) {
      const chip = e.target.closest(".effort-chip");
      if (!chip) return;
      currentEffort = chip.dataset.effort;
      document
        .querySelectorAll(".effort-chip")
        .forEach((c) => c.classList.remove("active"));
      chip.classList.add("active");
    }

    function handleSaveLearning() {
      if (!currentSkillContext) return;
      const what = document.getElementById("learning-what").value.trim();
      const benefit = document
        .getElementById("learning-benefit")
        .value.trim();
      if (!what || !benefit) {
        alert("Isi dulu apa yang lo pelajarin dan manfaatnya ya.");
        return;
      }
      const date = todayISO();
      const xp = EFFORT_XP[currentEffort] || 0;

      if (editingEntryId) {
        const existing = (learningState.entries || []).find(
          (e) => e.id === editingEntryId
        );
        if (existing) {
          existing.what = what;
          existing.benefit = benefit;
          existing.effort = currentEffort;
          existing.xp = xp;
        }
        saveLearning();
      } else {
        const entry = {
          id: Date.now() + "_" + Math.random().toString(16).slice(2),
          date,
          skillId: currentSkillContext.skillId,
          skillName: currentSkillContext.skillName,
          skillType: currentSkillContext.skillType,
          what,
          benefit,
          effort: currentEffort,
          xp
        };
        logLearningEntry(entry);
      }

      closeLearningModal();
      renderLearningStatsAndProgress();
      renderLearningHistory();
      renderLearningHeatmap();
    }

    // ------------------- Nav & HoHo Drag --------------------------
    function setupNav() {
      const tabs = document.querySelectorAll(".nav-tab");
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const viewId = tab.dataset.view;
          document
            .querySelectorAll("section")
            .forEach((s) => (s.style.display = "none"));
          document.getElementById(viewId).style.display = "block";
          tabs.forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          const hohoTasks = document.getElementById("hoho-floating");
          const hohoLearning = document.getElementById(
            "hoho-learning-floating"
          );

          if (viewId === "tasks-view") {
            if (hohoTasks) hohoTasks.style.display = "block";
            if (hohoLearning) hohoLearning.style.display = "none";
          } else {
            if (hohoTasks) hohoTasks.style.display = "none";
            if (hohoLearning) hohoLearning.style.display = "block";
          }
        });
      });
    }

    function setupHoHoDrag() {
      const hoho = document.getElementById("hoho-floating");
      if (!hoho) return;
      let isDragging = false;
      let startX = 0;
      let startY = 0;
      let startLeft = 0;
      let startTop = 0;

      function onPointerDown(e) {
        isDragging = true;
        hoho.style.transition = "none";
        const rect = hoho.getBoundingClientRect();
        startLeft = rect.left;
        startTop = rect.top;
        startX = e.clientX;
        startY = e.clientY;
        window.addEventListener("pointermove", onPointerMove);
        window.addEventListener("pointerup", onPointerUp);
      }

      function onPointerMove(e) {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const newLeft = startLeft + dx;
        const newTop = startTop + dy;
        hoho.style.left = newLeft + "px";
        hoho.style.top = newTop + "px";
        hoho.style.right = "auto";
        hoho.style.bottom = "auto";
      }

      function onPointerUp() {
        isDragging = false;
        hoho.style.transition = "";
        window.removeEventListener("pointermove", onPointerMove);
        window.removeEventListener("pointerup", onPointerUp);
      }

      hoho.addEventListener("pointerdown", onPointerDown);
    }

    // ------------------- Init -------------------------------------
    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      const options = {
        weekday: "long",
        day: "numeric",
        month: "short",
        year: "numeric"
      };
      document.getElementById("today-label").textContent =
        "Today ¬∑ " + today.toLocaleDateString(undefined, options);

      loadState();

      document
        .getElementById("task-form")
        .addEventListener("submit", handleTaskFormSubmit);

      document
        .getElementById("effort-options")
        .addEventListener("click", handleEffortClick);
      document
        .getElementById("modal-save-btn")
        .addEventListener("click", handleSaveLearning);
      document
        .getElementById("modal-close-btn")
        .addEventListener("click", closeLearningModal);
      document
        .getElementById("modal-cancel-btn")
        .addEventListener("click", closeLearningModal);

      document
        .getElementById("day-modal-close-btn")
        .addEventListener("click", () =>
          document
            .getElementById("day-modal-backdrop")
            .classList.add("hidden")
        );

      document
        .getElementById("learning-day-modal-close-btn")
        .addEventListener("click", () =>
          document
            .getElementById("learning-day-modal-backdrop")
            .classList.add("hidden")
        );

      document.querySelectorAll(".skill-card").forEach((card) => {
        card.addEventListener("click", () => {
          const skillId = card.dataset.skillId;
          const skillName = card.dataset.skillName;
          const skillType = card.dataset.skillType;
          openLearningModal(skillId, skillName, skillType, null);
        });
      });

      renderTodaySummary();
      renderTasksList();
      renderHeatmap();

      renderLearningStatsAndProgress();
      renderLearningHistory();
      renderLearningHeatmap();
      setupNav();
      setupHoHoDrag();

      // default: tasks view active, hoho tasks visible
      const hohoTasks = document.getElementById("hoho-floating");
      const hohoLearning = document.getElementById("hoho-learning-floating");
      if (hohoTasks) hohoTasks.style.display = "block";
      if (hohoLearning) hohoLearning.style.display = "none";
    });
  </script>
</body>
</html>
